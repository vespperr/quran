"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[496],{1313:(a,e,t)=>{t.r(e),t.d(e,{deleteSurahDownload:()=>y,getAudioOffline:()=>f,getDB:()=>s,getDownloadedSurahs:()=>c,getSetting:()=>v,getStorageUsage:()=>g,getSurahOffline:()=>d,getVersesOffline:()=>h,isSurahDownloaded:()=>w,saveAudio:()=>u,saveSetting:()=>b,saveSurah:()=>o,saveVerses:()=>l});var r=t(198);async function n(){return await (0,r.P2)("quran-offline-db",1,{upgrade(a){a.objectStoreNames.contains("surahs")||a.createObjectStore("surahs",{keyPath:"id"}).createIndex("by-download-status","downloadStatus"),a.objectStoreNames.contains("verses")||a.createObjectStore("verses",{keyPath:"key"}).createIndex("by-surah","surahId"),a.objectStoreNames.contains("audio")||a.createObjectStore("audio",{keyPath:"key"}).createIndex("by-surah","surahId"),a.objectStoreNames.contains("settings")||a.createObjectStore("settings")}})}let i=null;async function s(){return i||(i=n()),i}async function o(a){let e=await s();e&&await e.put("surahs",{...a,isDownloaded:!0,downloadStatus:1,downloadDate:new Date})}async function l(a,e){let t=await s();if(!t)return;let r=t.transaction("verses","readwrite");for(let t of e)await r.store.put({key:"".concat(a,"-").concat(t.id),surahId:a,...t});await r.done}async function u(a,e,t){let r=await s();r&&await r.put("audio",{key:"".concat(a,"-").concat(e),surahId:a,reciterId:e,blob:t,size:t.size,downloadDate:new Date})}async function c(){let a=await s();if(!a)return[];try{return await a.getAllFromIndex("surahs","by-download-status",1)}catch(e){console.error("Error getting downloaded surahs:",e);try{return(await a.getAll("surahs")).filter(a=>a.isDownloaded)}catch(a){return console.error("Fallback error:",a),[]}}}async function d(a){let e=await s();if(e)return await e.get("surahs",a)}async function h(a){let e=await s();return e?await e.getAllFromIndex("verses","by-surah",a):[]}async function f(a,e){let t=await s();if(!t)return null;let r=await t.get("audio","".concat(a,"-").concat(e));return r?r.blob:null}async function w(a){try{let e=await s();if(!e)return!1;let t=await e.get("surahs",a);return!!t&&t.isDownloaded}catch(a){return console.error("Error checking if surah is downloaded:",a),!1}}async function y(a){let e=await s();if(!e)return;let t=await e.getAllFromIndex("verses","by-surah",a),r=e.transaction("verses","readwrite");for(let a of t)await r.store.delete(a.key);await r.done;let n=await e.getAllFromIndex("audio","by-surah",a),i=e.transaction("audio","readwrite");for(let a of n)await i.store.delete(a.key);await i.done;let o=await e.get("surahs",a);o&&(o.isDownloaded=!1,o.downloadStatus=0,await e.put("surahs",o))}async function g(){let a=await s();if(!a)return{totalSize:0,audioSize:0,textSize:0,surahCount:0};let e=0,t=0,r=0;try{e=(await a.getAll("audio")).reduce((a,e)=>a+e.size,0);try{r=(await a.getAllFromIndex("surahs","by-download-status",1)).length}catch(e){r=(await a.getAll("surahs")).filter(a=>a.isDownloaded).length}return t=(await a.getAll("verses")).reduce((a,e)=>{let t=JSON.stringify(e).length;return a+t},0),{totalSize:e+t,audioSize:e,textSize:t,surahCount:r}}catch(a){return console.error("Error calculating storage usage:",a),{totalSize:0,audioSize:0,textSize:0,surahCount:0}}}async function b(a,e){let t=await s();t&&await t.put("settings",e,a)}async function v(a){let e=await s();return e?await e.get("settings",a):null}},3999:(a,e,t)=>{t.d(e,{cn:()=>i});var r=t(2596),n=t(9688);function i(){for(var a=arguments.length,e=Array(a),t=0;t<a;t++)e[t]=arguments[t];return(0,n.QP)((0,r.$)(e))}},5600:(a,e,t)=>{t.d(e,{CH:()=>o,Lx:()=>d,MO:()=>u,c1:()=>h,dc:()=>f,oh:()=>s});var r=t(1313);let n="https://api.alquran.cloud/v1",i={alafasy:"https://server8.mp3quran.net/afs/",sudais:"https://server11.mp3quran.net/sds/",minshawi:"https://server9.mp3quran.net/minsh/",yasser:"https://server11.mp3quran.net/yasser/"},s=[{id:"ar.alafasy",name:{arabic:"مشاري راشد العفاسي",english:"Mishary Rashid Alafasy",kurdish:"مشاری ڕاشید ئەلعەفاسی"},audioBaseUrl:i.alafasy,alternativeBaseUrl:i.alafasy_alt},{id:"ar.yasser",name:{arabic:"  yasser",english:"yasser  ",kurdish:"مشاری ڕاشید ئەلعەفاسی"},audioBaseUrl:i.yasser,alternativeBaseUrl:i.alafasy_alt},{id:"ar.abdurrahmaansudais",name:{arabic:"عبد الرحمن السديس",english:"Abdurrahman As-Sudais",kurdish:"عەبدولڕەحمان ئەلسودەیس"},audioBaseUrl:i.sudais,alternativeBaseUrl:i.sudais_alt},{id:"ar.minshawi",name:{arabic:"محمد صديق المنشاوي",english:"Muhammad Siddiq Al-Minshawi",kurdish:"محەمەد سدیق ئەلمینشاوی"},audioBaseUrl:i.minshawi,alternativeBaseUrl:i.minshawi_alt}];async function o(){try{if("undefined"!=typeof navigator&&!navigator.onLine){let a=await l();if(a.length>0)return a;return[]}let a=await fetch("".concat(n,"/surah")),e=await a.json();if(200===e.code&&"OK"===e.status)return await Promise.all(e.data.map(async a=>{let e=await (0,r.isSurahDownloaded)(a.number);return{id:a.number,name:{arabic:a.name,english:a.englishName,kurdish:a.englishName},revelation:a.revelationType,bismillah:9!==a.number,versesCount:a.numberOfAyahs,audioUrl:c(a.number,"ar.alafasy"),isDownloaded:e}}));return[]}catch(a){console.error("Error fetching surahs:",a);try{return await l()}catch(a){return console.error("Error fetching offline surahs:",a),[]}}}async function l(){try{return await Promise.resolve().then(t.bind(t,1313)).then(a=>a.getDownloadedSurahs())}catch(a){return console.error("Error loading offline surahs:",a),[]}}async function u(a){try{let e="undefined"!=typeof navigator&&!navigator.onLine,t=await (0,r.isSurahDownloaded)(a);if(e||t){let t=await (0,r.getSurahOffline)(a);if(t){let e=await (0,r.getVersesOffline)(a);return{...t,verses:e.sort((a,e)=>a.id-e.id),isDownloaded:!0}}if(e)return null}let i=await fetch("".concat(n,"/surah/").concat(a)),s=await i.json(),o=await fetch("".concat(n,"/surah/").concat(a,"/en.sahih")),l=await o.json();if(200===s.code&&200===l.code){let a=s.data,e=a.ayahs.map((a,e)=>{let t=l.data.ayahs[e];return{id:a.numberInSurah,arabic:a.text,english:t.text,kurdish:t.text,timestamp:5*e}});return{id:a.number,name:{arabic:a.name,english:a.englishName,kurdish:a.englishName},revelation:a.revelationType,bismillah:9!==a.number,verses:e,audioUrl:c(a.number,"ar.alafasy"),isDownloaded:t}}return null}catch(e){console.error("Error fetching surah ".concat(a,":"),e);try{let e=await (0,r.getSurahOffline)(a);if(e){let t=await (0,r.getVersesOffline)(a);return{...e,verses:t.sort((a,e)=>a.id-e.id),isDownloaded:!0}}}catch(e){console.error("Error fetching offline surah ".concat(a,":"),e)}return null}}function c(a,e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=s.find(a=>a.id===e);if(!r)return null;let n=a.toString().padStart(3,"0"),i=t&&r.alternativeBaseUrl?r.alternativeBaseUrl:r.audioBaseUrl;return"".concat(i).concat(n,".mp3")}async function d(a,e){let t=c(a,e,!0);if(t)try{if((await fetch(t,{method:"HEAD"})).ok)return t}catch(a){console.error("Error checking alternative URL:",a)}return c(a,"ar.alafasy"===e?"ar.abdurrahmaansudais":"ar.alafasy")}async function h(a,e){try{let t=await u(a);if(!t)return console.error("Failed to download surah ".concat(a,": Could not fetch surah data")),!1;await (0,r.saveSurah)(t),await (0,r.saveVerses)(a,t.verses);let n=c(a,e);if(n)try{let t=await fetch(n);if(!t.ok){let n=await d(a,e);if(n){let t=await fetch(n);if(!t.ok)throw Error("Failed to fetch audio from alternative source: ".concat(t.statusText));let i=await t.blob();return await (0,r.saveAudio)(a,e,i),!0}throw Error("Failed to fetch audio: ".concat(t.statusText))}let i=await t.blob();await (0,r.saveAudio)(a,e,i)}catch(e){console.error("Error downloading audio for surah ".concat(a,":"),e)}return!0}catch(e){return console.error("Error downloading surah ".concat(a,":"),e),!1}}async function f(a,e){try{let t=await (0,r.getAudioOffline)(a,e);if(t)return URL.createObjectURL(t);let n=c(a,e);if(!n)throw Error("Audio URL not available for this surah/reciter combination");return n}catch(e){throw console.error("Error getting audio URL for surah ".concat(a,":"),e instanceof Error?e.message:String(e)),e}}},5982:(a,e,t)=>{t.d(e,{QuranProvider:()=>o,d:()=>l});var r=t(5155),n=t(2115),i=t(5600);let s=(0,n.createContext)(void 0);function o(a){let{children:e}=a,[t,o]=(0,n.useState)(1),[l,u]=(0,n.useState)(1),[c,d]=(0,n.useState)("arabic"),[h,f]=(0,n.useState)(i.oh[0].id),[w,y]=(0,n.useState)(!0),[g,b]=(0,n.useState)([]),[v,m]=(0,n.useState)(null),[S,k]=(0,n.useState)({}),[E,p]=(0,n.useState)(!1),[A,D]=(0,n.useState)(!1);(0,n.useEffect)(()=>{{let a=()=>{p(!navigator.onLine)};return window.addEventListener("online",a),window.addEventListener("offline",a),a(),D(!0),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",a)}}},[]),(0,n.useEffect)(()=>{async function a(){y(!0);try{let a=await (0,i.CH)();b(a)}catch(a){console.error("Error fetching surahs:",a)}finally{y(!1)}}A&&a()},[A]),(0,n.useEffect)(()=>{(async function(){if(A){if(y(!0),S[t]){m(S[t]),y(!1);return}try{let a=await (0,i.MO)(t);a&&(k(e=>({...e,[t]:a})),m(a))}catch(a){console.error("Error fetching surah:",a)}finally{y(!1)}}})()},[t,A,S]);let O=(0,n.useCallback)(async a=>{if(S[a])return S[a];try{let e=await (0,i.MO)(a);return e&&k(t=>({...t,[a]:e})),e}catch(a){return console.error("Error fetching surah:",a),null}},[S]),U=(0,n.useCallback)(()=>g,[g]),x=(0,n.useCallback)((a,e)=>{if(a!==t||!v)return"";let r=v.verses.find(a=>a.id===e);return r?r[c]||r.arabic:""},[t,v,c]),C=(0,n.useCallback)(()=>i.oh,[]),L=(0,n.useCallback)(()=>i.oh.find(a=>a.id===h),[h]),j=(0,n.useCallback)(async()=>{try{let a=await (0,i.CH)();if(b(a),t){let a=await (0,i.MO)(t);a&&(k(e=>({...e,[t]:a})),m(a))}}catch(a){throw console.error("Error refreshing surahs:",a),a}},[t]),B=(0,n.useCallback)(async(a,e)=>{try{return await (0,i.dc)(a,e)}catch(e){throw console.error("Error getting audio URL for surah ".concat(a,":"),e),e}},[]);return(0,r.jsx)(s.Provider,{value:{currentSurah:t,currentVerse:l,currentLanguage:c,currentReciter:h,isLoading:w,isOffline:E,surahs:g,surahData:v,setCurrentSurah:o,setCurrentVerse:u,setCurrentLanguage:d,setCurrentReciter:f,getSurah:O,getAllSurahs:U,getVerseText:x,getAllReciters:C,getCurrentReciterInfo:L,refreshSurahs:j,getAudioForSurah:B},children:e})}function l(){let a=(0,n.useContext)(s);if(void 0===a)throw Error("useQuran must be used within a QuranProvider");return a}}}]);